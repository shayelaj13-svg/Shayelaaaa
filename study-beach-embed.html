<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Study Beach â€” Embeddable</title>
  <!-- Tailwind CDN for quick styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* small safe defaults for Notion iframe sizing */
    html,body,#root { height: 100%; margin: 0; }
    .scrollable { max-height: 75vh; overflow:auto; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <div id="root" class="p-4"></div>

  <!-- React & Babel (for in-browser JSX transform) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- The app -->
  <script type="text/babel">

const { useState, useEffect } = React;

/* ---------- small helpers ---------- */
function useLocalStorage(key, initial) {
  const [value, setValue] = useState(() => {
    try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : initial; } catch { return initial; }
  });
  useEffect(() => { try { localStorage.setItem(key, JSON.stringify(value)); } catch {} }, [key, value]);
  return [value, setValue];
}

/* ---------- simplified UI components (no external libs) ---------- */
function AssetsPanel({ hero, setHero }) {
  const [assets, setAssets] = useLocalStorage("law.assets", { heroBg: hero.bg || "", pattern: hero.pattern || "" });

  useEffect(()=> {
    setHero(h=> ({ ...h, bg: assets.heroBg || h.bg, pattern: assets.pattern || h.pattern }));
  }, []); // run once

  const onPick = (field) => (e) => {
    const file = e.target.files?.[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      const dataUrl = String(reader.result);
      const next = { ...assets, [field]: dataUrl };
      setAssets(next);
      setHero(h => ({ ...h, [field === 'heroBg' ? 'bg' : 'pattern']: dataUrl }));
    };
    reader.readAsDataURL(file);
  };

  const clear = (field) => () => {
    const next = { ...assets, [field]: "" };
    setAssets(next);
    setHero(h => ({ ...h, [field === 'heroBg' ? 'bg' : 'pattern']: "" }));
  };

  return (
    <div className="rounded-xl border p-4 bg-white/80 shadow-sm">
      <div className="flex items-center justify-between mb-3">
        <div className="text-lg font-semibold">Backgrounds & Patterns</div>
        <div className="text-sm text-slate-500">optional</div>
      </div>

      <div className="grid md:grid-cols-2 gap-4">
        <div>
          <div className="font-medium mb-2">Hero (sunset)</div>
          <input type="file" accept="image/*" onChange={onPick('heroBg')} />
          {assets.heroBg && (
            <div className="mt-3">
              <img src={assets.heroBg} alt="hero" className="rounded-lg border max-h-40 object-cover" />
              <div className="mt-2 flex gap-2">
                <button className="px-3 py-1 rounded bg-rose-200" onClick={()=>setHero(h=>({ ...h, bg: assets.heroBg }))}>Set as banner</button>
                <button className="px-3 py-1 rounded bg-slate-200" onClick={clear('heroBg')}>Remove</button>
              </div>
            </div>
          )}
        </div>

        <div>
          <div className="font-medium mb-2">Overlay (pattern)</div>
          <input type="file" accept="image/*" onChange={onPick('pattern')} />
          {assets.pattern && (
            <div className="mt-3">
              <img src={assets.pattern} alt="pattern" className="rounded-lg border max-h-40 object-cover" />
              <div className="mt-2 flex gap-2">
                <button className="px-3 py-1 rounded bg-sky-200" onClick={()=>setHero(h=>({ ...h, pattern: assets.pattern }))}>Set overlay</button>
                <button className="px-3 py-1 rounded bg-slate-200" onClick={clear('pattern')}>Remove</button>
              </div>
            </div>
          )}
        </div>
      </div>
      <p className="text-sm text-slate-500 mt-3">Tip: uploads are saved in your browser (localStorage).</p>
    </div>
  );
}

/* Notes (simple markdown raw preview) */
function Notes({ storageKey }) {
  const [text, setText] = useLocalStorage(storageKey, "# Quick notes

Use **Markdown** here.

- Add cases
- Add points");
  return (
    <div className="grid md:grid-cols-2 gap-4">
      <div>
        <div className="text-sm font-medium mb-2">Editor (Markdown)</div>
        <textarea className="min-h-[220px] w-full p-2 border rounded-lg" value={text} onChange={(e)=>setText(e.target.value)} />
      </div>
      <div>
        <div className="text-sm font-medium mb-2">Preview (raw)</div>
        <div className="p-3 bg-white rounded-lg border min-h-[220px] whitespace-pre-wrap">{text}</div>
      </div>
    </div>
  );
}

/* Flashcards (basic) */
function Flashcards({ storageKey }) {
  const [cards, setCards] = useLocalStorage(storageKey, [
    { q: "Define mens rea", a: "The mental element of a crime." }
  ]);
  const [mode, setMode] = useState("edit");
  const [i, setI] = useState(0);
  const [show, setShow] = useState(false);

  const add = ()=> setCards([...cards, { q:"", a:"" }]);
  const del = (idx)=> setCards(cards.filter((_,j)=>j!==idx));

  return (
    <div>
      <div className="flex gap-2 mb-3">
        <button className={`px-3 py-1 rounded ${mode==='edit'?'bg-rose-300':'bg-slate-200'}`} onClick={()=>setMode('edit')}>Edit</button>
        <button className={`px-3 py-1 rounded ${mode==='study'?'bg-rose-300':'bg-slate-200'}`} onClick={()=>setMode('study')}>Study</button>
        <div className="ml-auto text-sm text-slate-600">{cards.length} cards</div>
      </div>

      {mode==='edit' ? (
        <div className="space-y-3">
          {cards.map((c,idx)=>(
            <div key={idx} className="p-3 bg-white border rounded-lg">
              <div className="grid md:grid-cols-2 gap-3">
                <div>
                  <div className="text-sm font-medium">Question</div>
                  <textarea className="w-full p-2 border rounded" value={c.q} onChange={(e)=>{ const copy=[...cards]; copy[idx].q=e.target.value; setCards(copy); }} />
                </div>
                <div>
                  <div className="text-sm font-medium">Answer</div>
                  <textarea className="w-full p-2 border rounded" value={c.a} onChange={(e)=>{ const copy=[...cards]; copy[idx].a=e.target.value; setCards(copy); }} />
                </div>
              </div>
              <div className="flex justify-end mt-2">
                <button className="px-2 py-1 bg-slate-200 rounded" onClick={()=>del(idx)}>Delete</button>
              </div>
            </div>
          ))}
          <button className="px-3 py-1 bg-rose-200 rounded" onClick={add}>Add card</button>
        </div>
      ) : (
        <div className="max-w-xl mx-auto">
          {cards.length===0 ? <p className="text-center text-slate-500">No cards</p> : (
            <div className="p-6 bg-white border rounded-lg text-center">
              <div className="text-sm mb-2">Card {i+1} / {cards.length}</div>
              <div className="text-xl min-h-[80px] flex items-center justify-center">{show ? cards[i].a : cards[i].q}</div>
              <div className="mt-3 flex justify-center gap-2">
                <button className="px-3 py-1 bg-slate-200 rounded" onClick={()=>setShow(s=>!s)}>{show?"Show question":"Show answer"}</button>
              </div>
              <div className="mt-2 flex justify-between">
                <button className="px-3 py-1 bg-slate-200 rounded" onClick={()=>{ setShow(false); setI((i-1+cards.length)%cards.length); }}>Prev</button>
                <button className="px-3 py-1 bg-slate-200 rounded" onClick={()=>{ setShow(false); setI((i+1)%cards.length); }}>Next</button>
              </div>
            </div>
          )}
        </div>
      )}
    </div>
  );
}

/* Quizzes (basic) */
function Quizzes({ storageKey }) {
  const [qs, setQs] = useLocalStorage(storageKey, [
    { prompt: "Which case established the neighbour principle?", options: ["Donoghue v Stevenson","Carlill","R v Brown"], answer: 0 }
  ]);
  const [taking, setTaking] = useState(false);
  const [answers, setAnswers] = useState({});
  const [score, setScore] = useState(null);

  const addQ = ()=> setQs([...qs, { prompt:"", options:["","",""], answer:0 }]);
  const delQ = (i)=> setQs(qs.filter((_,j)=>j!==i));
  const submit = ()=> { let s=0; qs.forEach((q,i)=> { if(answers[i]===q.answer) s++; }); setScore(s); };

  return (
    <div className="space-y-3">
      <div className="flex gap-2">
        <button className={`px-3 py-1 rounded ${!taking?'bg-rose-300':'bg-slate-200'}`} onClick={()=>setTaking(false)}>Build</button>
        <button className={`px-3 py-1 rounded ${taking?'bg-rose-300':'bg-slate-200'}`} onClick={()=>{ setTaking(true); setScore(null); }}>Take</button>
        <div className="ml-auto text-sm text-slate-600">{qs.length} q</div>
      </div>

      {!taking ? (
        <div className="space-y-3">
          {qs.map((q,i)=>(
            <div key={i} className="p-3 bg-white border rounded-lg space-y-2">
              <input className="w-full p-2 border rounded" value={q.prompt} onChange={(e)=>{ const copy=[...qs]; copy[i].prompt=e.target.value; setQs(copy); }} />
              {q.options.map((opt,j)=>(
                <div key={j} className="flex gap-2 items-center">
                  <input className="flex-1 p-2 border rounded" value={opt} onChange={(e)=>{ const copy=[...qs]; copy[i].options[j]=e.target.value; setQs(copy); }} />
                  <label className="text-sm"><input type="radio" name={`ans-${i}`} checked={q.answer===j} onChange={()=>{ const copy=[...qs]; copy[i].answer=j; setQs(copy); }} /> correct</label>
                </div>
              ))}
              <div className="flex justify-between mt-1">
                <button className="px-2 py-1 bg-slate-200 rounded" onClick={()=>{ const copy=[...qs]; copy[i].options.push(""); setQs(copy); }}>Add option</button>
                <button className="px-2 py-1 bg-slate-200 rounded" onClick={()=>delQ(i)}>Delete</button>
              </div>
            </div>
          ))}
          <button className="px-3 py-1 bg-rose-200 rounded" onClick={addQ}>Add question</button>
        </div>
      ) : (
        <div className="space-y-3">
          {qs.map((q,i)=>(
            <div key={i} className="p-3 bg-white border rounded-lg">
              <div className="font-medium mb-2">{q.prompt}</div>
              <div className="grid gap-2">
                {q.options.map((opt,j)=>(
                  <label key={j} className={`flex items-center gap-2 p-2 border rounded ${answers[i]===j? 'bg-rose-50': ''}`}>
                    <input type="radio" name={`take-${i}`} checked={answers[i]===j} onChange={()=>setAnswers(a=>({ ...a, [i]: j }))} /> {opt}
                  </label>
                ))}
              </div>
            </div>
          ))}
          <div className="flex gap-2 items-center"><button className="px-3 py-1 bg-rose-300 rounded" onClick={submit}>Submit</button> {score!==null && <div>Score: {score} / {qs.length}</div>}</div>
        </div>
      )}
    </div>
  );
}

/* Mind map (very simple draggable nodes) */
function MindMap({ storageKey }) {
  const [nodes, setNodes] = useLocalStorage(storageKey, [{ id:1, text:'Topic', x:60, y:40 }]);
  const [drag, setDrag] = useState(null);

  return (
    <div className="rounded-lg border bg-white overflow-hidden">
      <div className="p-2 flex gap-2">
        <button className="px-3 py-1 bg-slate-200 rounded" onClick={()=>setNodes([...nodes, { id:Date.now(), text:'New', x:40, y:40 }])}>Add</button>
        <button className="px-3 py-1 bg-slate-200 rounded" onClick={()=>setNodes([])}>Clear</button>
      </div>
      <div className="relative h-[240px] bg-gradient-to-b from-white to-slate-50">
        {nodes.map(n=>(
          <div key={n.id} style={{ left: n.x, top: n.y }} className="absolute cursor-move px-3 py-2 rounded border bg-rose-50"
               onMouseDown={(e)=>setDrag({ id:n.id, dx:e.clientX-n.x, dy:e.clientY-n.y })}
               onDoubleClick={()=>{ const t=prompt('Edit', n.text)||n.text; setNodes(nodes.map(x=> x.id===n.id? {...x, text:t}: x)); }}>
            {n.text}
        </div>
        ))}
        <div onMouseMove={(e)=>{ if(!drag) return; setNodes(ns=> ns.map(n=> n.id===drag.id? {...n, x: e.clientX-drag.dx, y: e.clientY-drag.dy}: n)); }} onMouseUp={()=>setDrag(null)} className="absolute inset-0"/>
      </div>
    </div>
  );
}

/* Table builder */
function TableBuilder({ storageKey }) {
  const [rows, setRows] = useLocalStorage(storageKey, [['Principle','Case','Ratio'], ['Mens rea','Woollin','Virtual certainty']]);

  return (
    <div>
      <div className="flex gap-2 mb-2">
        <button className="px-3 py-1 bg-slate-200 rounded" onClick={()=>setRows([...rows, Array(rows[0]?.length||3).fill('')])}>Add row</button>
        <button className="px-3 py-1 bg-slate-200 rounded" onClick={()=>setRows(rows.map(r=>[...r,'']))}>Add col</button>
        <button className="px-3 py-1 bg-slate-200 rounded" onClick={()=>setRows(rows.slice(0,-1))}>Remove row</button>
      </div>
      <div className="overflow-auto">
        <table className="min-w-[480px] w-full border rounded">
          <tbody>
            {rows.map((r,i)=>(
              <tr key={i} className="even:bg-rose-50/30">
                {r.map((cell,j)=>(
                  <td key={j} className="border p-2">
                    <input className="w-full outline-none" value={cell} onChange={(e)=>{ const copy=[...rows]; copy[i][j]=e.target.value; setRows(copy); }} />
                  </td>
                ))}
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}

/* Materials */
function Materials({ storageKey }) {
  const [items, setItems] = useLocalStorage(storageKey, [{ type:'link', label:'Lecture notes', url:'' }]);
  const add = ()=> setItems([...items, { type:'link', label:'', url:'' }]);
  const del = (i)=> setItems(items.filter((_,j)=> j!==i));
  return (
    <div>
      {items.map((it,i)=>(
        <div key={i} className="grid md:grid-cols-[1fr,2fr,auto] gap-2 items-center mb-2">
          <select className="p-2 border rounded" value={it.type} onChange={(e)=>{ const copy=[...items]; copy[i].type=e.target.value; setItems(copy); }}>
            <option value="link">Link</option><option value="file">File</option>
          </select>
          <input className="p-2 border rounded" value={it.label} onChange={(e)=>{ const copy=[...items]; copy[i].label=e.target.value; setItems(copy); }} placeholder="Title" />
          <input className="p-2 border rounded" value={it.url} onChange={(e)=>{ const copy=[...items]; copy[i].url=e.target.value; setItems(copy); }} placeholder="URL / description" />
          <button className="px-2 py-1 bg-slate-200 rounded" onClick={()=>del(i)}>Delete</button>
        </div>
      ))}
      <button className="px-3 py-1 bg-rose-200 rounded" onClick={add}>Add item</button>
    </div>
  );
}

/* Module wrapper */
function Module({ id, name }) {
  return (
    <div id={id} className="space-y-6">
      <h3 className="text-xl font-semibold">{name}</h3>
      <div className="grid gap-4">
        <div><div className="text-lg font-medium mb-2">Short Notes</div><Notes storageKey={`law.${id}.notes`} /></div>
        <div><div className="text-lg font-medium mb-2">Flashcards</div><Flashcards storageKey={`law.${id}.cards`} /></div>
        <div><div className="text-lg font-medium mb-2">Quizzes</div><Quizzes storageKey={`law.${id}.quiz`} /></div>
        <div><div className="text-lg font-medium mb-2">Mind Map</div><MindMap storageKey={`law.${id}.mind`} /></div>
        <div><div className="text-lg font-medium mb-2">Tables</div><TableBuilder storageKey={`law.${id}.table`} /></div>
        <div><div className="text-lg font-medium mb-2">Materials</div><Materials storageKey={`law.${id}.materials`} /></div>
      </div>
    </div>
  );
}

/* Main */
function App(){
  const MODULES = [
    { id: "criminal", name: "Criminal Law" },
    { id: "public", name: "Public Law" },
    { id: "contract", name: "Contract Law" },
    { id: "lsm", name: "Legal System & Method" },
  ];
  const [hero, setHero] = useLocalStorage("law.hero", { title: "The Summer I Studied Law âœ¨", emoji: "", bg: "", pattern: "" });

  return (
    <div className="p-4 prose bg-white/70 rounded-lg shadow-sm" style={{ backgroundImage: hero.bg? `url(${hero.bg})` : undefined, backgroundSize:'cover', backgroundPosition:'center' }}>
      <header className="mb-4">
        <div className="flex items-center gap-3 mb-2">
          <div className="text-2xl">ðŸŒž</div>
          <div className="px-2 py-1 bg-rose-200 rounded text-rose-900 text-sm">summer study</div>
        </div>
        <h1 className="text-2xl md:text-4xl font-bold">{hero.title} {hero.emoji}</h1>
        <p className="text-slate-600">A cozy study space for your law modules.</p>

        <div className="mt-3 grid grid-cols-2 sm:grid-cols-4 gap-2">
          {MODULES.map(m => (<a key={m.id} href={`#${m.id}`} className="rounded-lg p-2 text-sm font-medium bg-gradient-to-br from-rose-100 to-rose-50 border shadow">{m.name}</a>))}
        </div>
      </header>

      <div className="mb-4">
        <AssetsPanel hero={hero} setHero={setHero} />
      </div>

      <main className="space-y-6">
        {MODULES.map(m => <Module key={m.id} id={m.id} name={m.name} />)}
      </main>

      <footer className="text-center text-sm text-slate-500 mt-6">Saved locally in your browser â€¢ Open in a new tab to use full-screen.</footer>
    </div>
  );
}

/* Render */
ReactDOM.createRoot(document.getElementById('root')).render(<App />);

  </script>
</body>
</html>
